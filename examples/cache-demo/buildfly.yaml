project:
  name: "cache-demo"
  version: "1.0.0"
  variables:
    install_dir: "${HOME}/.buildfly-deps"
    build_type: "Release"
    cxx_compiler: "g++"
    cxx_flags: "-O2 -std=c++17"

dependencies:
  # 需要构建的依赖
  fmt:
    version: "8.0.1"
    source:
      type: "git"
      url: "https://github.com/fmtlib/fmt.git"
      tag: "8.0.1"
    build_system: "cmake"
    cmake_options:
      - "FMT_TEST=OFF"
      - "FMT_DOC=OFF"
      - "CMAKE_POSITION_INDEPENDENT_CODE=ON"
    build_commands:
      configure: |
        cmake -B ${BUILD_DIR} \
          -DCMAKE_INSTALL_PREFIX=${INSTALL_DIR} \
          -DCMAKE_BUILD_TYPE=${BUILD_TYPE} \
          ${CMAKE_OPTIONS}
      build: "cmake --build ${BUILD_DIR} --config ${BUILD_TYPE} -j${CPU_CORES}"
      install: "cmake --install ${BUILD_DIR} --config ${BUILD_TYPE}"

  # 不需要构建的依赖（header-only）
  spdlog:
    version: "1.9.2"
    source:
      type: "git"
      url: "https://github.com/gabime/spdlog.git"
      tag: "v1.9.2"
    build_system: "none"

  # 需要构建的依赖（使用 Makefile）
  zlib:
    version: "1.2.11"
    source:
      type: "archive"
      url: "https://zlib.net/zlib-1.2.11.tar.gz"
    build_system: "configure"
    configure_options:
      - "--prefix=${INSTALL_DIR}"
      - "--shared"
    build_commands:
      configure: "./configure ${CONFIGURE_OPTIONS}"
      build: "make -j${CPU_CORES}"
      install: "make install"

build_profiles:
  development:
    variables:
      build_type: "Debug"
      cxx_flags: "-g -O0 -std=c++17"
    dependencies:
      - "fmt"
      - "spdlog"

  production:
    variables:
      build_type: "Release"
      cxx_flags: "-O3 -DNDEBUG -std=c++17"
    dependencies:
      - "fmt"
      - "spdlog"
      - "zlib"

  minimal:
    dependencies:
      - "spdlog"
